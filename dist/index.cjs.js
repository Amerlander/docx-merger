var J=Object.create;var B=Object.defineProperty;var Z=Object.getOwnPropertyDescriptor;var q=Object.getOwnPropertyNames;var G=Object.getPrototypeOf,H=Object.prototype.hasOwnProperty;var K=(s,t,e)=>t in s?B(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var _=(s,t)=>()=>(t||s((t={exports:{}}).exports,t),t.exports);var Q=(s,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of q(t))!H.call(s,i)&&i!==e&&B(s,i,{get:()=>t[i],enumerable:!(n=Z(t,i))||n.enumerable});return s};var b=(s,t,e)=>(e=s!=null?J(G(s)):{},Q(t||!s||!s.__esModule?B(e,"default",{value:s,enumerable:!0}):e,s));var E=(s,t,e)=>(K(s,typeof t!="symbol"?t+"":t,e),e);var P=_((ct,k)=>{var S=require("@xmldom/xmldom"),U=function(s,t){let e=new S.XMLSerializer,n=s.map(async function(i,r){let o=await i.file("word/styles.xml").async("string"),a=new S.DOMParser().parseFromString(o,"text/xml"),l=a.getElementsByTagName("w:style");for(let u in l)if(/^\d+$/.test(u)&&l[u].getAttribute){let m=l[u].getAttribute("w:styleId");l[u].setAttribute("w:styleId",m+"_"+r);let p=l[u].getElementsByTagName("w:basedOn")[0];if(p){let c=p.getAttribute("w:val");p.setAttribute("w:val",c+"_"+r)}let g=l[u].getElementsByTagName("w:next")[0];if(g){let c=g.getAttribute("w:val");g.setAttribute("w:val",c+"_"+r)}let d=l[u].getElementsByTagName("w:link")[0];if(d){let c=d.getAttribute("w:val");d.setAttribute("w:val",c+"_"+r)}let w=l[u].getElementsByTagName("w:numId")[0];if(w){let c=w.getAttribute("w:val");w.setAttribute("w:val",c+r)}await R(i,r,m)}let y=o.indexOf("<w:styles ");o=o.replace(o.slice(y),e.serializeToString(a.documentElement)),i.file("word/styles.xml",o)});return Promise.all(n)},V=async function(s,t){let e=s.map(async function(n){let i=await n.file("word/styles.xml").async("string");i=i.substring(i.indexOf("<w:style "),i.indexOf("</w:styles")),t.push(i)});return Promise.all(e)},R=async function(s,t,e){let n=await s.file("word/document.xml").async("string");n=n.replace(new RegExp('w:val="'+e+'"',"g"),'w:val="'+e+"_"+t+'"'),s.file("word/document.xml",n)},W=async function(s,t){let e=await s.file("word/styles.xml").async("string"),n=e.indexOf("<w:style "),i=e.indexOf("</w:styles>");e=e.replace(e.slice(n,i),t.join("")),s.file("word/styles.xml",e)};k.exports={mergeStyles:V,prepareStyles:U,updateStyleRel_Content:R,generateStyles:W}});var F=_((mt,M)=>{var I=require("@xmldom/xmldom"),Y=async function(s,t){let e=1,n=s.map(async function(i,r){let o=i.folder("word/media").files;for(let a in o)if(/^word\/media/.test(a)&&a.length>11){let l=e++;t[l]={},t[l].oldTarget=a,t[l].newTarget=a.replace(/[0-9]/,"_"+l).replace("word/",""),t[l].fileIndex=r,await C(i,l,t),await D(i,l,t)}});return Promise.all(n)},C=async function(s,t,e){let n=await s.file("word/_rels/document.xml.rels").async("string"),i=new I.DOMParser().parseFromString(n,"text/xml"),r=i.getElementsByTagName("Relationships")[0].childNodes,o=new I.XMLSerializer;for(let l in r)/^\d+$/.test(l)&&r[l].getAttribute&&"word/"+r[l].getAttribute("Target")===e[t].oldTarget&&(e[t].oldRelID=r[l].getAttribute("Id"),r[l].setAttribute("Target",e[t].newTarget),r[l].setAttribute("Id",e[t].oldRelID+"_"+t));let a=n.indexOf("<Relationships");n=n.replace(n.slice(a),o.serializeToString(i.documentElement)),s.file("word/_rels/document.xml.rels",n)},D=async function(s,t,e){let n=await s.file("word/document.xml").async("string");n=n.replace(new RegExp(e[t].oldRelID+'"',"g"),e[t].oldRelID+"_"+t+'"'),s.file("word/document.xml",n)},tt=async function(s,t,e){for(let n in t){let i=await e[t[n].fileIndex].file(t[n].oldTarget).async("uint8array");s.file("word/"+t[n].newTarget,i)}};M.exports={prepareMediaFiles:Y,updateMediaRelations:C,updateMediaContent:D,copyMediaFiles:tt}});var $=_((gt,L)=>{var f=require("@xmldom/xmldom"),et=function(s,t){let e=s.map(async n=>{let i=await n.file("[Content_Types].xml").async("string"),o=new f.DOMParser().parseFromString(i,"text/xml").getElementsByTagName("Types")[0].childNodes;for(let a in o)if(/^\d+$/.test(a)&&o[a].getAttribute){let l=o[a].getAttribute("ContentType");t[l]||(t[l]=o[a].cloneNode())}});return Promise.all(e)},nt=function(s,t){let e=s.map(async n=>{let i=await n.file("word/_rels/document.xml.rels").async("string"),o=new f.DOMParser().parseFromString(i,"text/xml").getElementsByTagName("Relationships")[0].childNodes;for(let a in o)if(/^\d+$/.test(a)&&o[a].getAttribute){let l=o[a].getAttribute("Id");t[l]||(t[l]=o[a].cloneNode())}});return Promise.all(e)},st=async function(s,t){let e=await s.file("[Content_Types].xml").async("string"),n=new f.DOMParser().parseFromString(e,"text/xml"),i=new f.XMLSerializer,r=n.documentElement.cloneNode();for(let a in t)r.appendChild(t[a]);let o=e.indexOf("<Types");e=e.replace(e.slice(o),i.serializeToString(r)),s.file("[Content_Types].xml",e)},it=async function(s,t){let e=await s.file("word/_rels/document.xml.rels").async("string"),n=new f.DOMParser().parseFromString(e,"text/xml"),i=new f.XMLSerializer,r=n.documentElement.cloneNode();for(let a in t)r.appendChild(t[a]);let o=e.indexOf("<Relationships");e=e.replace(e.slice(o),i.serializeToString(r)),s.file("word/_rels/document.xml.rels",e)};L.exports={mergeContentTypes:et,mergeRelations:nt,generateContentTypes:st,generateRelations:it}});var X=_((dt,z)=>{var A=require("@xmldom/xmldom"),rt=function(s){let t=new A.XMLSerializer,e=s.map(async function(n,i){let r=n.file("word/numbering.xml");if(!r)return;let o=await r.async("string"),a=new A.DOMParser().parseFromString(o,"text/xml"),l=a.getElementsByTagName("w:abstractNum");for(let m in l)if(/^\d+$/.test(m)&&l[m].getAttribute){let p=l[m].getAttribute("w:abstractNumId");l[m].setAttribute("w:abstractNumId",p+i);let g=l[m].getElementsByTagName("w:pStyle");for(let c in g)if(g[c].getAttribute){let x=g[c].getAttribute("w:val");g[c].setAttribute("w:val",x+"_"+i)}let d=l[m].getElementsByTagName("w:numStyleLink");for(let c in d)if(d[c].getAttribute){let x=d[c].getAttribute("w:val");d[c].setAttribute("w:val",x+"_"+i)}let w=l[m].getElementsByTagName("w:styleLink");for(let c in w)if(w[c].getAttribute){let x=w[c].getAttribute("w:val");w[c].setAttribute("w:val",x+"_"+i)}}let y=a.getElementsByTagName("w:num");for(let m in y)if(/^\d+$/.test(m)&&y[m].getAttribute){let p=y[m].getAttribute("w:numId");y[m].setAttribute("w:numId",p+i);let g=y[m].getElementsByTagName("w:abstractNumId");for(let d in g)if(g[d].getAttribute){let w=g[d].getAttribute("w:val");g[d].setAttribute("w:val",w+i)}}let u=o.indexOf("<w:numbering ");o=o.replace(o.slice(u),t.serializeToString(a.documentElement)),n.file("word/numbering.xml",o)});return Promise.all(e)},lt=function(s,t){let e=s.map(async function(n){let i=n.file("word/numbering.xml");if(!i)return;let r=await i.async("string");r=r.substring(r.indexOf("<w:abstractNum "),r.indexOf("</w:numbering")),t.push(r)});return Promise.all(e)},ot=async function(s,t){let e=s.file("word/numbering.xml");if(!e)return;let n=await e.async("string"),i=n.indexOf("<w:abstractNum "),r=n.indexOf("</w:numbering>");n=n.replace(n.slice(i,r),t.join("")),s.file("word/numbering.xml",n)};z.exports={prepareNumbering:rt,mergeNumbering:lt,generateNumbering:ot}});var j=b(require("jszip")),T=b(P()),O=b(F()),h=b($()),N=b(X());var v=class{constructor(){E(this,"insertPageBreak",function(){let t='<w:p> 					<w:r> 						<w:br w:type="page"/> 					</w:r> 				</w:p>';this._builder.push(t)});E(this,"insertRaw",function(t){this._builder.push(t)});this._body=[],this._header=[],this._footer=[],this._pageBreak=!0,this._Basestyle="source",this._style=[],this._numbering=[],this._files=[],this._contentTypes={},this._media={},this._rel={},this._builder=this._body}async initialize(t,e){e=e||[],this._pageBreak=typeof t.pageBreak!="undefined"?!!t.pageBreak:!0,this._Basestyle=t.style||"source";for(let n of e){let i=await new j.default().loadAsync(n);this._files.push(i)}this._files.length>0&&await this.mergeBody(this._files)}async mergeBody(t){this._builder=this._body,await h.default.mergeContentTypes(t,this._contentTypes),await O.default.prepareMediaFiles(t,this._media),await h.default.mergeRelations(t,this._rel),await N.default.prepareNumbering(t),await N.default.mergeNumbering(t,this._numbering),await T.default.prepareStyles(t,this._style),await T.default.mergeStyles(t,this._style);let e=t.map(async(n,i)=>{let r=await n.file("word/document.xml").async("string");r=r.substring(r.indexOf("<w:body>")+8),r=r.substring(0,r.indexOf("</w:body>")),r=r.substring(0,r.lastIndexOf("<w:sectPr")),this.insertRaw(r),this._pageBreak&&i<t.length-1&&this.insertPageBreak()});return Promise.all(e).then(()=>{})}async save(t){let e=this._files[0];if(!e||!e.file)throw new Error("JSZip file not properly loaded");let n=await e.file("word/document.xml").async("string"),i=n.indexOf("<w:body>")+8,r=n.lastIndexOf("<w:sectPr");return n=n.replace(n.slice(i,r),this._body.join("")),await h.default.generateContentTypes(e,this._contentTypes),await O.default.copyMediaFiles(e,this._media,this._files),await h.default.generateRelations(e,this._rel),await N.default.generateNumbering(e,this._numbering),await T.default.generateStyles(e,this._style),e.file("word/document.xml",n),await e.generateAsync({type:t,compression:"DEFLATE",compressionOptions:{level:4}})}};module.exports=v;
//# sourceMappingURL=index.cjs.js.map
